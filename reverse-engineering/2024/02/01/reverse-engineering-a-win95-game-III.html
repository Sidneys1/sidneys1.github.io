<!DOCTYPE html>
<html lang="en"><head>
	<meta charset="utf-8">

	<link rel="preload" href="https://sidneys1.github.io/assets/OpenDyslexic3-Regular.otf" as="font" crossorigin="anonymous">
	<link rel="preload" href="https://sidneys1.github.io/assets/OpenDyslexicMono-Regular.otf" as="font" crossorigin="anonymous">
	<link rel="preload" href="https://sidneys1.github.io/assets/css/main.css" as="style" />

	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="onion-location"
		content="http://sidneys77crlfslcr7zmj3msmxchgnxhrxlp3p3kbaswo7twchjnicid.onion/reverse-engineering/2024/02/01/reverse-engineering-a-win95-game-III.html" />
	<link rel="icon" type="image/png" sizes="16x16"
		href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYBAMAAAASWSDLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAwUExURU03LQsKCjRLXmBfW7hSE5xdMqNxTeGqSrKLX09qi5R9hHCnv7bDvaWgnfPWpvHt2OhtVZsAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAECSURBVCjPY5goCAQsjCDSjAFEiri4gChBEEdJ3KXcEcoRUmAvKWGEcZREytlhHEFFgVAQxQiWEYQARogBIKYQlLMbZJeQgKIgQxuT0umNQPbsiYoRDBlnlH+ClM49M2kZQ9ppIRBHefUZBQ6GjDvCn4AmMQFl2BhabJQ+CUpcYN5zRhEok6vwU5DvFeed0xPDGCJarf4YX4/VXaysmMaQmlb+/v37VxKFwgxhDKmhJc/r+xIEBQXCgDKhz/z+/3/AwGAcCuI8j+h5/y5Z0ArMuVf37t2JVYJv0zIY0oCc5w6CUgK/3ICc4BN1/949F1i7ICyDoS10bvi//89l/xqGdQAA2bZcXLL532IAAAAASUVORK5CYII=" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Reverse Engineering a Windows 95 Game | Sidneys1.com on GitHub Pages</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Reverse Engineering a Windows 95 Game" />
<meta name="author" content="Sidneys1" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I recently rediscovered an obscure 1997 Simon &amp; Schuster / Marshall Media edutainment game for Windows 95 that I played as a kid: Math Invaders. In this part, we’ll investigate whether we can enter an “editor mode”, hinted at within the strings contained within the program. There’s even a ✨surprise ending✨ that I didn’t see coming!" />
<meta property="og:description" content="I recently rediscovered an obscure 1997 Simon &amp; Schuster / Marshall Media edutainment game for Windows 95 that I played as a kid: Math Invaders. In this part, we’ll investigate whether we can enter an “editor mode”, hinted at within the strings contained within the program. There’s even a ✨surprise ending✨ that I didn’t see coming!" />
<link rel="canonical" href="https://sidneys1.github.io/reverse-engineering/2024/02/01/reverse-engineering-a-win95-game-III.html" />
<meta property="og:url" content="https://sidneys1.github.io/reverse-engineering/2024/02/01/reverse-engineering-a-win95-game-III.html" />
<meta property="og:site_name" content="Sidneys1.com on GitHub Pages" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-02-01T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Reverse Engineering a Windows 95 Game" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Sidneys1"},"dateModified":"2024-02-01T00:00:00-05:00","datePublished":"2024-02-01T00:00:00-05:00","description":"I recently rediscovered an obscure 1997 Simon &amp; Schuster / Marshall Media edutainment game for Windows 95 that I played as a kid: Math Invaders. In this part, we’ll investigate whether we can enter an “editor mode”, hinted at within the strings contained within the program. There’s even a ✨surprise ending✨ that I didn’t see coming!","headline":"Reverse Engineering a Windows 95 Game","mainEntityOfPage":{"@type":"WebPage","@id":"https://sidneys1.github.io/reverse-engineering/2024/02/01/reverse-engineering-a-win95-game-III.html"},"url":"https://sidneys1.github.io/reverse-engineering/2024/02/01/reverse-engineering-a-win95-game-III.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="https://sidneys1.github.io/assets/css/main.css">
	<link rel="stylesheet" href="https://sidneys1.github.io/hitcount.py.cgi?path=%2Freverse-engineering%2F2024%2F02%2F01%2Freverse-engineering-a-win95-game-III.html" fetchpriority="low" /><link type="application/atom+xml" rel="alternate" href="https://sidneys1.github.io/feed.xml" title="Sidneys1.com on GitHub Pages" /><script defer src="https://sidneys1.github.io/assets/mastodon_comments.js" onload="initComments()"></script><!-- KaTeX -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
		integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">

	<!-- The loading of KaTeX is deferred to speed up page rendering -->
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
		integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
		crossorigin="anonymous"></script>

	<!-- To automatically render math in text elements, include the auto-render extension: -->
	<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
		integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
		onload="renderMathInElement(document.body);"></script>

	<script type="module">
		/*
		 * This code is only used for loading/saving preferences
		 * to/from `localstorage`. If scripts are disabled all
		 * the theming still works, they just won't persist. :^)
		 */

		// Definition of preferences. Individual toggles should be
		// `id`'d `${key}-${value}`.
		const PREFERENCES = {
			'color': ['blue', 'green', 'red'],
			'mode': ['auto', 'light', 'dark', 'black'],
			'align': ['left', 'justify'],
			'font': ['default', 'od'],
		};

		// Save preferences to `localstorage`.
		function savePreferences() {
			var p = {
			};

			Object.entries(PREFERENCES).forEach(([key, values]) => {
				p[key] = values.find(value =>
					document.getElementById(`${key}-${value}`).checked);
			});

			localStorage.setItem('preferences', JSON.stringify(p));
		};

		// Run at page load
		// document.addEventListener("DOMContentLoaded", function (_, __) {
		// Load preferences once.
		const p = JSON.parse(localStorage.getItem('preferences') || '{}');
		Object.entries(PREFERENCES).forEach(([key, values]) =>
			document.getElementById(`${key}-${p[key] || values[0]}`).checked = true);

		// Register change handlers.
		Object.entries(PREFERENCES).forEach(([key, values]) =>
			values.forEach(value =>
				document.getElementById(`${key}-${value}`).addEventListener('change', e =>
					savePreferences())));
		// });
	</script>
	<noscript><style> .jsonly { display: none } </style></noscript>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="https://sidneys1.github.io/">Sidneys1.com on GitHub Pages</a>

	<span class="coffee"><a title="Buy me a Coffee" href="https://ko-fi.com/sidneys1" target="_blank" rel="noreferrer">
    <svg class="svg-icon">
			<use xlink:href="/assets/coffee-cup-1.svg#coffee"></use>
    </svg>

	</a></span><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="https://sidneys1.github.io/tags.html">Tags</a><a class="page-link" href="https://sidneys1.github.io/categories.html">Categories</a><a class="page-link" href="https://sidneys1.github.io/series.html">Series</a></div>
      </nav></div>

</header>

<div id="theme-parent">
	<div id="theme-select">
		<fieldset id="color-select">
			<legend align="bottom">Accent</legend>
			<input id="color-blue" type="radio" name="color" value="blue" checked /><label for="color-blue" title="Blue">💧</label>
			<input id="color-green" type="radio" name="color" value="green" /><label for="color-green" title="Green">🌳</label>
			<input id="color-red" type="radio" name="color" value="red" /><label for="color-red" title="Red">❤️</label>
		</fieldset>
		<fieldset id="mode-select">
			<legend>mode</legend>
			<input id="mode-auto" type="radio" name="mode" value="auto" checked /><label for="mode-auto" title="Auto">🪄</label>
			<input id="mode-light" type="radio" name="mode" value="light" /><label for="mode-light" title="Light">☀️</label>
			<input id="mode-dark" type="radio" name="mode" value="dark" /><label for="mode-dark" title="Dark">🌕</label>
			<input id="mode-black" type="radio" name="mode" value="black" /><label for="mode-black" title="Black (AMOLED)">🌑</label>
		</fieldset>
		<fieldset id="align-select">
			<legend>Align</legend>
			<input id="align-left" type="radio" name="align" value="left" checked /><label for="align-left" title="Left">⬅️</label>
			<input id="align-justify" type="radio" name="align" value="justify" /><label for="align-justify" title="Justify">↔️</label>
		</fieldset>
		<fieldset id="font-select">
			<legend>Font</legend>
			<input id="font-default" type="radio" name="font" value="default" checked /><label for="font-default" style="font-family: system-ui;" title="System Font">Aa</label>
			<input id="font-od" type="radio" name="font" value="od" /><label for="font-od" style="font-family: opendyslexic;" title="OpenDyslexic">Od</label>
		</fieldset>
		<noscript title="JavaScript is disabled. Preferences can not be saved to browser local storage.">
			ℹ️ <em>Preferences can not be saved.</em>
		</noscript>
	</div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

	<header class="post-header">
		<h1 class="post-title p-name" itemprop="name headline">Reverse Engineering a Windows 95 Game</h1>
		<h2 class="post-title p-name">Editor Mode, and Conclusion</h1><p class="post-meta">
			<time class="dt-published" datetime="2024-02-01T00:00:00-05:00" itemprop="datePublished">Feb 1, 2024
			</time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person">
				<span class="p-author h-card" itemprop="name">Sidneys1</span></span>&nbsp;•&nbsp;<a href="https://sidneys1.github.io/tags.html#programming" style="display: inline;"
				class="tag">programming</a>&nbsp;•&nbsp;<a href="https://sidneys1.github.io/tags.html#reverse-engineering" style="display: inline;"
				class="tag">reverse-engineering</a>&nbsp;•&nbsp;<a href="https://sidneys1.github.io/tags.html#ghidra" style="display: inline;"
				class="tag">ghidra</a></p><div class="multipart">
			<em>This post has multiple parts:</em>
			<ul>
				
				
					
				
					
				
					
				
					
				
					
						
							<li><a href="https://sidneys1.github.io/reverse-engineering/2023/02/23/reverse-engineering-a-win95-game-I.html">Reverse Engineering a Windows 95 Game &ndash; Reversing Asset Storage</a> (Part I)</li>
						
						
					
				
					
						
							<li><a href="https://sidneys1.github.io/reverse-engineering/2023/03/16/reverse-engineering-a-win95-game-II.html">Reverse Engineering a Windows 95 Game &ndash; Reversing (Undocumented) Settings</a> (Part II)</li>
						
						
					
				
					
				
					
						
							<li style="list-style-type: disclosure-closed;"><em>Reverse Engineering a Windows 95 Game &ndash; Editor Mode, and Conclusion</em> (Part III)</li>
						
						
					
				
					
				
					
				
					
				
				
			</ul>
		</div></header><!-- <div class="post-toc"> -->
	
	<!-- </div> -->

	<div class="post-content e-content" itemprop="articleBody">
		<!-- cSpell:words Schuster DirectX autorun pakrat -->
<!-- cSpell:ignore PAKS AMOVIE DSETUP DSETUPE DSETUPJ MATHINV SSPUNINS Bmps Ihighsco RIFFÀ -->

<p>I recently rediscovered an obscure 1997 Simon &amp; Schuster / Marshall Media edutainment game for Windows 95 that I played
as a kid: <a href="https://archive.org/details/MathInvaders">Math Invaders</a>. In this part, we’ll investigate whether we can
enter an “editor mode”, hinted at within the <code class="language-plaintext highlighter-rouge">strings</code> contained within the program. There’s even a
✨<span class="shimmer">surprise ending</span>✨ that I didn’t see coming!</p>

<!--more-->
<hr />

<p>Here’s where we left off, investigating the disassembly of a function that references a mysterious string:
<code class="language-plaintext highlighter-rouge">*** EDITOR MODE ***</code>. Cleaning the disassembly up and commenting to be a bit to be more readable gives us:</p>

<div class="code-split-root" data-file-name=".cpp"><div class="code-split-scroll">

    <div style="--left: 8;" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Because `param_1` from the disassembly (aka `this`) is passed to</span>
<span class="c1">// `CWnd::SetWindowTextA` at the end, this function probably belongs</span>
<span class="c1">// to a class inheriting `CWnd`.</span>
<span class="k">class</span> <span class="nc">CGameWnd</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CWnd</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">CGameWnd</span><span class="o">::</span><span class="n">_updateWindowTitle</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// Don't do anything if we're in fullscreen mode.</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gFullscreen</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">unknown_334</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// If the variable at offset 0x334 is not 0/FALSE/NULL,</span>
		<span class="c1">// we have a file loaded.</span>
</code></pre></div>    </div>

    <div class="language-cpp code-split highlighter-rouge" style="--left: 8;"><div class="highlight"><pre class="highlight"><code>		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">unknown_3714</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="c1">// If the variable at offset 0x3714 is 0/FALSE/NULL,</span>
			<span class="c1">// we're in "editor mode"... whatever that is!</span>
			<span class="c1">// Append text indicating this to the buffer.</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">" - *** EDITOR MODE ***"</span><span class="p">);</span>
		<span class="p">}</span>
</code></pre></div>    </div>

    <div class="language-cpp code-split highlighter-rouge" style="--left: 4;"><div class="highlight"><pre class="highlight"><code>	<span class="p">}</span>
</code></pre></div>    </div>

    <div class="language-cpp code-split highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="c1">// Set the window title to the contents of the buffer.</span>
	<span class="k">this</span><span class="o">-&gt;</span><span class="n">SetWindowTextA</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>

  </div></div>

<p>Ok! So to activate editor mode, we need to <strong>1)</strong> not be fullscreen, <strong>2)</strong> have <code class="language-plaintext highlighter-rouge">CGameWnd-&gt;unknown_334</code> be non-zero,
and <strong>3)</strong> have <code class="language-plaintext highlighter-rouge">CGameWnd-&gt;unknown_3714</code> be zero. Enabling fullscreen (via the <samp>3d.ini</samp> file described in
part II) no longer seems to crash my game (that must have been a mistake of mine!). The game starts and plays in
fullscreen, and the title even updates between “Paused, Press ‘p’ to resume.” and “Running…” when we press
<kbd>P</kbd>!</p>

<div>

  <aside>

    <p>While I could use a debugger to change the value at runtime, this is the only place the value is read, so we can assume
that any editor mode functionality has also been stripped out…</p>

  </aside>

  <p>But try as I might, <span class="aside-attn">no amount of reverse engineering is allowing me to toggle the
<code class="language-plaintext highlighter-rouge">unknown_3714</code> variable</span>. No code even exists (that I can find) to change it, except during initialization or
loading of levels, when it’s always set to <code class="language-plaintext highlighter-rouge">TRUE</code>. So I have a theory: there <em>was</em> an editor mode, but its functionality
has been “removed” behind something like <code class="language-plaintext highlighter-rouge">#ifdef EDITOR</code>.</p>

</div>

<p>Well then! Without a deus ex machina, it looks like we’ll never break into the “editor mode”. I reached out to the
community to see if anyone knew more about the game itself, or had heard of a source code leak for this nearly 30 year
old game. A few people were even so kind as to search Usenet for me. But nothing was turning up. A few months passed and
I’d pretty much given up on ever finishing this part III post.</p>

<h2 id="vindication"><a href="https://c.tenor.com/vV7u0Ur7I0YAAAAd/tenor.gif" target="_blank" referrerpolicy="no-referrer">Vindication!</a></h2>

<div class="chat rfloat">
	<div class="bubble from-them">
		<q>You could try downloading this SSK@<span class="blur">YoUTHinkYOUrecLeVeRdONtYou?</span>/SSPYTH.zip</q>
	</div>
	<div class="bubble from-them">
		<q>Its password seems to be the file name.</q>
	</div>
</div>

<p>Months after I’d given up I received an encrypted message, sent to the SimpleX address listed in my website footer. It
didn’t contain much more than a Freenet hash. I hurriedly installed a client and accessed the hash — the file
downloaded — the password worked — and inside? <span class="shimmer">Beautiful, wonderful source
code</span>, with “last modified” dates ranging from <em>December 1995 to January 1997</em>! And sure enough, there are several
instances of <code class="language-plaintext highlighter-rouge">#ifdef EDITOR</code> that block the “Editor Mode” from being used, as I suspected! In fact, editor mode is
implemented as a completely separate static library, that is only linked into the executable when editor mode is to be
used. No wonder none of the relevant code can be found when reverse engineering the released binary!</p>

<p>Now that we have source code and can fully analyze the game in the ground truth, let’s poke around and see what we can
find. The source code is laid out as follows:</p>

<ul>
  <li>📁 <samp>3DLIB</samp> - <em>The core 3D engine.</em>
    <ul>
      <li>📄 <em>Various Assembly, and C++ source and header files.</em></li>
    </ul>
  </li>
  <li>📁 <samp>EditLib</samp> - <em>Editor Mode functionality.</em>
    <ul>
      <li>📄 <em>Various C++ source and header files.</em></li>
    </ul>
  </li>
  <li>📁 <samp>RES</samp> - <em>The game icon in BMP and ICO formats.</em></li>
  <li>🔨 <em>Various Microsoft Developer Studio (Visual C++) files.</em></li>
  <li>📄 <em>Various C++ source and header files.</em></li>
  <li>📄 <em>Some example save files.</em></li>
  <li>⚙️ <samp>SSPYTH.EXE</samp> - <em>A compiled binary.</em></li>
  <li>🔧 <samp>3D.INI</samp> - <em>An example configuration file.</em></li>
</ul>

<h3 id="cheat-codes">Cheat Codes</h3>

<div>

  <aside>

    <p>A little more digging in Ghidra and I would have found them, as they print certain messages when activated and these
messages are visible as strings in the binary (even the unused codes!).</p>

  </aside>

  <p><span class="aside-attn">The game has a few cheat codes!</span> They can be activated by typing the code in during play,
as it keeps a buffer of the last 20 key presses. All cheat codes begin with <kbd>K</kbd> and are committed with
<kbd>L</kbd>:</p>

</div>

<div class="no-reverse">

  <table>
    <thead>
      <tr>
        <th style="text-align: right">                Cheat Code</th>
        <th style="text-align: center">Message</th>
        <th style="text-align: left">Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align: right"><span class="aside-attn"><kbd><kbd>K</kbd><kbd>E</kbd><kbd>Y</kbd><kbd>1-4</kbd><kbd>L</kbd></kbd></span></td>
        <td style="text-align: center"><samp>Add Key</samp></td>
        <td style="text-align: left">Gives the specified key (1-4).</td>
      </tr>
      <tr>
        <td style="text-align: right"><kbd><kbd>K</kbd><kbd>W</kbd><kbd>N</kbd><kbd>0-9</kbd><kbd>L</kbd></kbd></td>
        <td style="text-align: center"><samp>Add Weapon</samp></td>
        <td style="text-align: left">Gives the specified weapon (0-9) with max ammo.</td>
      </tr>
      <tr>
        <td style="text-align: right"><kbd><kbd>K</kbd><kbd>V</kbd><kbd>U</kbd><kbd>R</kbd><kbd>L</kbd></kbd></td>
        <td style="text-align: center"><samp>Add Strength, Shield</samp></td>
        <td style="text-align: left">Sets max strength, max shield, and dons the spacesuit.</td>
      </tr>
      <tr>
        <td style="text-align: right"><span class="aside-attn"><kbd><kbd>K</kbd><kbd>H</kbd><kbd>J</kbd><kbd>1-6</kbd><kbd>L</kbd></kbd></span></td>
        <td style="text-align: center"><em>None</em></td>
        <td style="text-align: left">Gives the specified item (1-6), however items 2, 3, and 6 are not allowed to be given via this cheat.<br />The items 1-6 are: “health pack”, “light divider”, “time warper”, “drainer field”, “ultra drainer field,” and “reflection”.</td>
      </tr>
      <tr>
        <td style="text-align: right"><span class="aside-attn"><kbd><kbd>K</kbd><kbd>Y</kbd><kbd>H</kbd><kbd>R</kbd><kbd>L</kbd></kbd></span></td>
        <td style="text-align: center"><samp>Add Everything</samp></td>
        <td style="text-align: left">Adds all keys, weapons, and allowed items.</td>
      </tr>
      <tr>
        <td style="text-align: right"><span class="aside-attn"><kbd><kbd>K</kbd><kbd>N</kbd><kbd>N</kbd><kbd>L</kbd></kbd></span></td>
        <td style="text-align: center"><samp>Problem Debug Mode ON</samp><br /><samp>Problem Debug Mode OFF</samp></td>
        <td style="text-align: left">Toggles a mode in which math problems’ expected answers are printed.</td>
      </tr>
      <tr>
        <td style="text-align: right"><kbd><kbd>K</kbd><kbd>01-27</kbd><kbd>L</kbd></kbd></td>
        <td style="text-align: center"><em>None</em></td>
        <td style="text-align: left">Go to level 01-27.</td>
      </tr>
    </tbody>
  </table>

  <aside>

    <p>The strings <code class="language-plaintext highlighter-rouge">Add Key</code>, <code class="language-plaintext highlighter-rouge">Add Everything</code>, and <code class="language-plaintext highlighter-rouge">Problem Debug Mode %s</code> do actually exist in the release binary, but the
code to activate them (as well as the <code class="language-plaintext highlighter-rouge">KHJ#L</code> code) is not present. The source code I have does not have any mechanism
to remove it (e.g., a preprocessor directive), so my assumption is that some of the cheat codes were removed from the
“final” build of the game, but that these changes were not committed to the version of the source code I have access to.</p>

  </aside>

</div>

<h3 id="building-a-27-year-old-game">Building a 27 Year Old Game</h3>

<div class="clearfix">

  <div class="carousel__holder rfloat" style="" data-height="300px">
    <div id="carousel0" class="carousel">
        
          <input class="carousel__activator" type="radio" name="carousel0" id="0a" checked="checked" />
        
          <input class="carousel__activator" type="radio" name="carousel0" id="0b" />
        
          <input class="carousel__activator" type="radio" name="carousel0" id="0c" />
        
          <input class="carousel__activator" type="radio" name="carousel0" id="0d" />
        
        
          
          
          
          
          <div class="carousel__controls">
              <label class="carousel__control carousel__control--backward" for="0d">&lt;</label>
              <label class="carousel__control carousel__control--forward" for="0b">&gt;</label>
          </div>
        
          
          
          
          
          <div class="carousel__controls">
              <label class="carousel__control carousel__control--backward" for="0a">&lt;</label>
              <label class="carousel__control carousel__control--forward" for="0c">&gt;</label>
          </div>
        
          
          
          
          
          <div class="carousel__controls">
              <label class="carousel__control carousel__control--backward" for="0b">&lt;</label>
              <label class="carousel__control carousel__control--forward" for="0d">&gt;</label>
          </div>
        
          
          
          
          
          <div class="carousel__controls">
              <label class="carousel__control carousel__control--backward" for="0c">&lt;</label>
              <label class="carousel__control carousel__control--forward" for="0a">&gt;</label>
          </div>
        
        <div class="carousel__track">
          <ul>
            
            <li class="carousel__slide"><img alt="/images/reverse-engineering-a-win95-game-III/dev-studio-opt.png" src="https://sidneys1.github.io/images/reverse-engineering-a-win95-game-III/dev-studio-opt.png" style="" /></li>
            
            <li class="carousel__slide"><img alt="/images/reverse-engineering-a-win95-game-III/open-workspace-opt.png" src="https://sidneys1.github.io/images/reverse-engineering-a-win95-game-III/open-workspace-opt.png" style="" /></li>
            
            <li class="carousel__slide"><img alt="/images/reverse-engineering-a-win95-game-III/select-project.png" src="https://sidneys1.github.io/images/reverse-engineering-a-win95-game-III/select-project.png" style="" /></li>
            
            <li class="carousel__slide"><img alt="/images/reverse-engineering-a-win95-game-III/rebuild-all.png" src="https://sidneys1.github.io/images/reverse-engineering-a-win95-game-III/rebuild-all.png" style="" /></li>
            
          </ul>
        </div>
        <div class="carousel__indicators">
            
              <label class="carousel__indicator" for="0a"></label>
            
              <label class="carousel__indicator" for="0b"></label>
            
              <label class="carousel__indicator" for="0c"></label>
            
              <label class="carousel__indicator" for="0d"></label>
            
        </div>
    </div>
</div>

  <style>
.carousel__holder {
	width: 100%;
	position: relative;
	padding-bottom: 300px;
	margin: 1rem 0 1rem;
}

@media screen and (max-width: 1800px) {
	.carousel__holder {
		padding-bottom: calc(min(40vh, 300px));
	}
}

@media screen and (min-width: 1800px) {
	.carousel__holder:is(.rfloat, .lfloat) {
		padding-bottom: calc(min(40%, 300px));
	}
}

.carousel {
  height: 100%;
  width: 100%;
  overflow: hidden;
  text-align: center;
  position: absolute;
  padding: 0;
}
.carousel__controls,
.carousel__activator {
  display: none;
}

.carousel__activator:nth-of-type(1):checked ~ .carousel__track {
  -webkit-transform: translateX(-000%);
          transform: translateX(-000%);
}
.carousel__activator:nth-of-type(1):checked ~ .carousel__slide:nth-of-type(1) {
  transition: opacity 0.5s, -webkit-transform 0.5s;
  transition: opacity 0.5s, transform 0.5s;
  transition: opacity 0.5s, transform 0.5s, -webkit-transform 0.5s;
  top: 0;
  left: 0;
  right: 0;
  opacity: 1;
  -webkit-transform: scale(1);
          transform: scale(1);
}
.carousel__activator:nth-of-type(1):checked ~ .carousel__controls:nth-of-type(1) {
  display: block;
  opacity: 1;
}
.carousel__activator:nth-of-type(1):checked ~ .carousel__indicators .carousel__indicator:nth-of-type(1) {
  opacity: 1;
}

.carousel__activator:nth-of-type(2):checked ~ .carousel__track {
  -webkit-transform: translateX(-100%);
          transform: translateX(-100%);
}
.carousel__activator:nth-of-type(2):checked ~ .carousel__slide:nth-of-type(2) {
  transition: opacity 0.5s, -webkit-transform 0.5s;
  transition: opacity 0.5s, transform 0.5s;
  transition: opacity 0.5s, transform 0.5s, -webkit-transform 0.5s;
  top: 0;
  left: 0;
  right: 0;
  opacity: 1;
  -webkit-transform: scale(1);
          transform: scale(1);
}
.carousel__activator:nth-of-type(2):checked ~ .carousel__controls:nth-of-type(2) {
  display: block;
  opacity: 1;
}
.carousel__activator:nth-of-type(2):checked ~ .carousel__indicators .carousel__indicator:nth-of-type(2) {
  opacity: 1;
}

.carousel__activator:nth-of-type(3):checked ~ .carousel__track {
  -webkit-transform: translateX(-200%);
          transform: translateX(-200%);
}
.carousel__activator:nth-of-type(3):checked ~ .carousel__slide:nth-of-type(3) {
  transition: opacity 0.5s, -webkit-transform 0.5s;
  transition: opacity 0.5s, transform 0.5s;
  transition: opacity 0.5s, transform 0.5s, -webkit-transform 0.5s;
  top: 0;
  left: 0;
  right: 0;
  opacity: 1;
  -webkit-transform: scale(1);
          transform: scale(1);
}
.carousel__activator:nth-of-type(3):checked ~ .carousel__controls:nth-of-type(3) {
  display: block;
  opacity: 1;
}
.carousel__activator:nth-of-type(3):checked ~ .carousel__indicators .carousel__indicator:nth-of-type(3) {
  opacity: 1;
}

.carousel__activator:nth-of-type(4):checked ~ .carousel__track {
  -webkit-transform: translateX(-300%);
          transform: translateX(-300%);
}
.carousel__activator:nth-of-type(4):checked ~ .carousel__slide:nth-of-type(4) {
  transition: opacity 0.5s, -webkit-transform 0.5s;
  transition: opacity 0.5s, transform 0.5s;
  transition: opacity 0.5s, transform 0.5s, -webkit-transform 0.5s;
  top: 0;
  left: 0;
  right: 0;
  opacity: 1;
  -webkit-transform: scale(1);
          transform: scale(1);
}
.carousel__activator:nth-of-type(4):checked ~ .carousel__controls:nth-of-type(4) {
  display: block;
  opacity: 1;
}
.carousel__activator:nth-of-type(4):checked ~ .carousel__indicators .carousel__indicator:nth-of-type(4) {
  opacity: 1;
}


.carousel__control {
  height: 100%;
  vertical-align: middle;
  /* width: 30px; */
  margin-top: -15px;
  top: calc(50% - 0.5em);
  position: absolute;
  display: block;
  cursor: pointer;
  /* border-width: 5px 5px 0 0;
  border-style: solid;
  border-color: #fafafa; */
  font-size: 48pt;
  color: #fafafa;
  font-weight: 900;
  text-shadow: 0 0 10px  black;
  opacity: 0.35;
  /* opacity: 1; */
  outline: 0;
  z-index: 3;
  transition: opacity 250ms linear;
  /* box-shadow: 0 0 10px black; */
}
.carousel__control:hover {
  opacity: 1;
  transition: opacity 250ms linear;
}
.carousel__control--backward {
  left: 20px;
  /* -webkit-transform: rotate(-135deg);
          transform: rotate(-135deg); */
}
.carousel__control--forward {
  right: 20px;
  /* -webkit-transform: rotate(45deg);
          transform: rotate(45deg); */
}
.carousel__indicators {
  position: absolute;
  bottom: 20px;
  width: 100%;
  text-align: center;
}
.carousel__indicator {
  height: 10px;
  width: 10px;
  border-radius: 100%;
  display: inline-block;
  z-index: 2;
  cursor: pointer;
  opacity: 0.35;
  margin: 0 2.5px 0 2.5px;
  box-shadow: 0 0 10px black;
  transition: opacity 250ms linear;
}
.carousel__indicator:hover {
  opacity: 0.75;
  transition: opacity 250ms linear;
}
.carousel__track {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  padding: 0;
  margin: 0;
  transition: -webkit-transform 0.5s ease 0s;
  transition: transform 0.5s ease 0s;
  transition: transform 0.5s ease 0s, -webkit-transform 0.5s ease 0s;
}
.carousel__track .carousel__slide {
  display: flex;
  align-items: center;
  top: 0;
  left: 0;
  right: 0;
  opacity: 1;
}

.carousel__track .carousel__slide:nth-of-type(1) {
  -webkit-transform: translateX(000%);
          transform: translateX(000%);
}

.carousel__track .carousel__slide:nth-of-type(2) {
  -webkit-transform: translateX(100%);
          transform: translateX(100%);
}

.carousel__track .carousel__slide:nth-of-type(3) {
  -webkit-transform: translateX(200%);
          transform: translateX(200%);
}

.carousel__track .carousel__slide:nth-of-type(4) {
  -webkit-transform: translateX(300%);
          transform: translateX(300%);
}


.carousel--scale .carousel__slide {
  -webkit-transform: scale(0);
          transform: scale(0);
}
.carousel__slide {
  height: 100%;
  position: absolute;
  opacity: 0;
  overflow: hidden;

  /* background-size: contain;
  background-repeat: no-repeat;
  background-position: center; */
}
.carousel__slide img {
	display: block;
	width: auto;
	height: auto;
	max-width: 100%;
	max-height: 100%;
	box-shadow: unset;
}
.carousel__slide img:hover {
	box-shadow: unset;
}

.carousel__slide .overlay {height: 100%;}
.carousel--thumb .carousel__indicator {
  height: 30px;
  width: 30px;
}
.carousel__indicator {
  background-color: #fafafa;
}

.carousel__slide:nth-of-type(1),
.carousel--thumb .carousel__indicators .carousel__indicator:nth-of-type(1) {
}

.carousel__slide:nth-of-type(2),
.carousel--thumb .carousel__indicators .carousel__indicator:nth-of-type(2) {
}

.carousel__slide:nth-of-type(3),
.carousel--thumb .carousel__indicators .carousel__indicator:nth-of-type(3) {
}

.carousel__slide:nth-of-type(4),
.carousel--thumb .carousel__indicators .carousel__indicator:nth-of-type(4) {
}

</style>

  <p>Of course, the pièces de résistance of having access to the source code: editor mode! Let’s see what it takes to get it
working. First, we’ll need to get the source code building. Thanks to the lovely project <a href="https://dosbox-x.com/">DOSBox-X</a>, emulating
older Windows operating systems is as simple as following <a href="https://dosbox-x.com/wiki/Guide%3AInstalling-Windows-95">a guide</a>. I also sourced the following disk images:
<a href="https://archive.org/details/win-95-osr-2">Windows 95 OSR2</a><sup id="fnref:osr2" role="doc-noteref"><a href="#fn:osr2" class="footnote" rel="footnote">1</a></sup>, <a href="https://winworldpc.com/product/visual-c/4x">Visual C++ 4.2</a>, the <a href="https://archive.org/details/gamesdk">DirectX 1.0 SDK</a>, and the
<a href="https://archive.org/details/the-net-cd">ActiveMovie SDK</a><sup id="fnref:amalt" role="doc-noteref"><a href="#fn:amalt" class="footnote" rel="footnote">2</a></sup> (this disk contains many other interesting installers as well). If you’re planning on
building up such a virtual machine yourself, you’ll have to find your own product keys, sorry.</p>

  <p>Breezing through the guide leaves us with a fully functional Windows 95 install, with Visual C++ 4.2 (which includes the
Microsoft Developer Studio IDE - which we’ll need), the DirectX SDK, and the ActiveMovie SDK. Our source code contains
an <code class="language-plaintext highlighter-rouge">.mdp</code> file, which is a Developer Studio project, so let’s open it and build the default project with
<kbd><kbd>Ctrl</kbd>+<kbd>B</kbd></kbd>!</p>

</div>

<div class="code-split-root" data-file-name=".log"><div class="code-split-scroll">

    <div style="clear: both;" class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--------------------Configuration: 3dlib - Win32 Debug--------------------
Compiling...
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge code-split"><div class="highlight">
<pre class="highlight">
<code>decomp.cpp
<span class="err">fatal error C1083: Cannot open source file: 'C:\Sspyth\3dlib\decomp.cpp': No such file or directory</span>

Error executing cl.exe.
Sspyth.exe - 1 error(s), 4 warning(s)
</code></pre></div></div>

  </div></div>

<p>Alright, some errors, but nothing we can’t solve. The first thing we notice is we’re missing a file
<samp>3DLIB\DECOMP.CPP</samp>. Poking around, we find there’s a file named <samp>3DLIB\aviDECOMP.CPP</samp>. A simple
file rename gets us past this error. Re-running the build gives us another error, now in the linking process. It can’t
seem to find the 3DLib and ActiveMovie libraries:</p>

<div class="language-plaintext highlighter-rouge" data-file-name=".log"><div class="highlight">
<pre class="highlight">
<code>e_frame.cpp
.\.\ztest.hpp(9) : <span class="err">fatal error C1083: Cannot open include file: 'strmif.h': No such file or directory</span>
</code></pre></div></div>

<div class="float-reverse">

  <p class="rfloat"><img src="https://sidneys1.github.io/images/reverse-engineering-a-win95-game-III/game-not-installed.png" alt="Game not installed" /></p>

  <p>That’s as easy as adding the full path to the ActiveMovie SDK’s include directory to the compiler path, and adding the
<samp>lib\StrmBase.lib</samp> file and the 3DLib output file to the linker properties. Our project now builds, and we
can verify that the game runs! Well, it tells us <samp>Game not installed, run the setup program.</samp>, but commenting
out a few lines in <code class="language-plaintext highlighter-rouge">CSspythApp::InitInstance()</code> fixes that:</p>

</div>

<div style="clear: both;" data-file-name="SSPYTH.CPP" class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Check for game installed</span>
<span class="c1">// char buffer[260];</span>
<span class="c1">// strcpy(buffer, "");</span>
<span class="c1">// GetRegString("Version", buffer, 20);</span>
<span class="c1">// if (strcmp(SSP_VERSION, buffer)) {</span>
<span class="c1">// 	AfxMessageBox("Game not installed, run the setup program.", MB_OK | MB_ICONSTOP);</span>
<span class="c1">// 	return FALSE;</span>
<span class="c1">// }</span>
</code></pre></div></div>

<p>Installing the game and pointing the <code class="language-plaintext highlighter-rouge">pakpath</code> setting in <samp>3D.INI</samp> to the install directory allows the game
to load assets and run!</p>

<p><img src="https://sidneys1.github.io/images/reverse-engineering-a-win95-game-III/game-running.png" alt="Game running" /></p>

<h3 id="editor-mode">Editor Mode</h3>

<p>So what do we need to enable editor mode? Let’s create a new build configuration just for this use case. We already know
we have to add <code class="language-plaintext highlighter-rouge">/D EDITOR</code> to the compiler settings, and doing so builds… and fails. Why now?</p>

<div class="language-plaintext highlighter-rouge" data-file-name=".log"><div class="highlight">
<pre class="highlight">
<code>sspyth.obj : <span class="err">error LNK2001: unresolved external symbol "public: void __thiscall CEditFrame::EditDoor(void *)"(?EditDoor@CEditFrame@@QAEXPAX@Z)
sspyth__/Sspyth.exe : fatal error LNK1120: 7 unresolved externals</span>
Error executing link.exe.
Sspyth.exe - 8 error(s), 0 warning(s)
</code></pre></div></div>

<p>Ah, EditLib! Let’s add that to our linker options as well and try again. This time the build succeeds and
we can run the game as before. Now, how do we activate it? We know so far that: <strong>1)</strong> the game has to be in windowed mode,
so we set <code class="language-plaintext highlighter-rouge">fullscreen=0</code> in <samp>3D.INI</samp>; and <strong>2)</strong> there are some mystery values in the main window class that must be
set just-so to be “in editor mode”. Thankfully now we can look at actual code! It turns out our
<code class="language-plaintext highlighter-rouge">CGameWnd::_updateWindowTitle()</code> decompilation above is actually named <code class="language-plaintext highlighter-rouge">CMainFrame::ShowPauseState()</code>:</p>

<div data-file-name="MainFrm.cpp" class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">CMainFrame</span><span class="o">::</span><span class="n">ShowPauseState</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">g_FullScreen</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">m_game</span><span class="p">.</span><span class="n">m_pscene</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">char</span> <span class="n">drive</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">directory</span><span class="p">[</span><span class="mi">200</span><span class="p">],</span> <span class="n">name</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">extension</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
		<span class="n">_splitpath</span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span> <span class="n">drive</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">extension</span><span class="p">);</span>
		<span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"  S.S. Pythagoras  -  '%s'  "</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">m_game</span><span class="p">.</span><span class="n">m_GameMode</span><span class="p">)</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">" - *** EDITOR MODE ***"</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">m_game</span><span class="p">.</span><span class="n">Paused</span><span class="p">())</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">" - Paused,  press 'p' to resume."</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">" - Running..."</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"  S.S. Pythagoras  -  NO ACTIVE LEVEL"</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">SetWindowText</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="float-reverse">

  <div class="rfloat"><div class="code-split-root" data-file-name="GAME.CPP"><div class="code-split-scroll">

        <div style="--left: 4" class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">CGame</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="n">CKeyboard</span><span class="o">&amp;</span> <span class="n">keys</span><span class="p">)</span> <span class="p">{</span>
</code></pre></div>        </div>

        <div class="language-c++ code-split highlighter-rouge" style="--left: 4"><div class="highlight"><pre class="highlight"><code>	<span class="k">if</span> <span class="p">(</span><span class="n">keys</span><span class="p">.</span><span class="n">KeyDownWasUp</span><span class="p">(</span><span class="sc">'G'</span><span class="p">))</span>	<span class="p">{</span>
		<span class="n">m_GameMode</span> <span class="o">=</span> <span class="o">!</span><span class="n">m_GameMode</span><span class="p">;</span>
		<span class="n">GetMainFrame</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ShowPauseState</span><span class="p">();</span>
	<span class="p">}</span>
</code></pre></div>        </div>

        <div class="language-c++ code-split highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">}</span>
</code></pre></div>        </div>

      </div></div></div>

  <p>Awesome, my guesses were <em>really</em> close. <code class="language-plaintext highlighter-rouge">unknown_334</code> is <code class="language-plaintext highlighter-rouge">m_game.m_pscene</code>, and <code class="language-plaintext highlighter-rouge">unknown_3714</code> is <code class="language-plaintext highlighter-rouge">m_game.m_GameMode</code>.
Let’s see if I’m right, and <code class="language-plaintext highlighter-rouge">m_GameMode</code> is changed with a <code class="language-plaintext highlighter-rouge">#ifdef EDITOR</code>-surrounded key input. <code class="language-plaintext highlighter-rouge">m_GameMode</code> is only
changed in two places in the code, both in <samp>GAME.CPP</samp>. The first is during initialization, where it is set to
<code class="language-plaintext highlighter-rouge">TRUE</code>. The second place is further down the file, in <code class="language-plaintext highlighter-rouge">CGame::Update(CKeyboard&amp;)</code>:</p>

</div>

<p>Ok, this isn’t surrounded by <code class="language-plaintext highlighter-rouge">#ifdef EDITOR</code>… I suspect again that the “final” version of the game saw a few code
changes that weren’t included in the copy of the code I have. But a little digging shows that <code class="language-plaintext highlighter-rouge">m_GameMode</code> alone has no
real effect, because just a little further down is the code to actually <em>perform</em> editor mode:</p>

<div class="code-split-root" data-file-name="GAME.CPP"><div class="code-split-scroll">

    <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">////////////////////////////////////////// EDITOR</span>
<span class="cp">#ifdef EDITOR
</span></code></pre></div>    </div>

    <div class="language-c++ code-split highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">keys</span><span class="p">.</span><span class="n">KeyDownWasUp</span><span class="p">(</span><span class="sc">'I'</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">GetApp</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">ShowEditFrame</span><span class="p">();</span>
	<span class="n">GetApp</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">m_editframe</span><span class="o">-&gt;</span><span class="n">OnInsertButton</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <div class="language-c++ code-split highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#endif
</span></code></pre></div>    </div>

  </div></div>

<div>

  <aside>

    <p>I’ve skipped over some steps I had to take related to the release version PAK files referencing unused — and
unincluded — textures and models. I suspect the released game runs fine without them because it only loads used
textures, while the editor mode loads all textures (in case you want to use them) that are defined. As I don’t have the
original game assets (I only have source code and the PAK files distributed with the released game) I can’t recover
these textures and models, and so I just copied existing files and gave them the expected name.</p>

    <p>Another item of interest is that in activating editor mode <em>no</em> textures will load properly, as the files on-disk are
expected to be <a href="https://en.wikipedia.org/wiki/PCX">PCX</a> format, but when packing a PAK file the raw data is stored
unencoded (likely to increase loading speed). My extractor from Part I, PAKrat, just extracts the raw data into the
specified file path, leaving me with invalid PCX files. The actual format, as stored in the PAK, is like so:</p>

    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="p">{</span>
  <span class="c1">// Width and height of the data:</span>
  <span class="kt">int</span> <span class="n">columns</span><span class="p">,</span> <span class="n">rows</span><span class="p">;</span>
  <span class="c1">// The data itself (pretend):</span>
  <span class="kt">unsigned</span> <span class="kt">char</span><span class="p">[</span><span class="n">columns</span> <span class="o">*</span> <span class="n">rows</span><span class="p">];</span>
  <span class="c1">// The width, height, and x-y offset</span>
  <span class="c1">// of the desired sub-image:</span>
  <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>    </div>

  </aside>

  <p style="clear: both;">So, we need to press <kbd>G</kbd> to switch the game mode, and then <kbd>I</kbd> (I suspect for <strong>I</strong>nsert or
<strong>I</strong>nspect) <span class="aside-attn">will show the editor controls</span>! Once editor mode is active you can also
press <kbd>E</kbd> to <strong>E</strong>dit door and entity instances, or <kbd>T</kbd> to edit the focused object’s <strong>T</strong>ype. Let’s
give it a go:</p>

  <div class="popunder">
	
		<img class="pop" style="" src="https://sidneys1.github.io/images/reverse-engineering-a-win95-game-III/editor-mode-thumb.png" alt="Editor Mode" title="Editor Mode" onclick="document.getElementById('110-editor-mode').showModal()" />
	
	<em>Click to zoom.</em>
</div>

  <dialog class="popover" id="110-editor-mode" onclick="document.getElementById('110-editor-mode').close()">
	<!-- <form method="dialog">
		<button class="close">X</button>
	  </form> -->
	<img class="pop-in" src="https://sidneys1.github.io/images/reverse-engineering-a-win95-game-III/editor-mode-opt.png" alt="Editor Mode" title="Editor Mode" loading="lazy" />
</dialog>

</div>

<h2 id="next-steps">Next Steps</h2>

<p>If there’s ever going to be a follow-up to this three-part post, there’s a few things I’d like to try:</p>

<ul>
  <li>Add modern <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> keyboard controls — the current control scheme is
<kbd>A</kbd>/<kbd>Z</kbd> for forward/back, and <kbd>Shift</kbd>/<kbd>X</kbd> for left/right.</li>
  <li>Get the game running on modern versions of Windows — I’d like to do this by getting it running “well” on each
newer OS starting with Windows XP and moving forward.</li>
  <li>Properly handle texture files when extracting — PAKrat (from part I) doesn’t extract the PCX textures correctly.</li>
</ul>
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:osr2" role="doc-endnote">
      <p>The <a href="https://en.wikipedia.org/wiki/Windows_95#Editions">3rd release of Windows 95</a>, “OEM Release 2”, added support for FAT32 drives. <a href="#fnref:osr2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:amalt" role="doc-endnote">
      <p>Alternative source in disk 4 of <a href="https://archive.org/details/storm-1">Storm #1 - Internet Archive</a>. <a href="#fnref:amalt" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

	</div>

	<hr/>
	<div class="multipart center">
		<em>This post has multiple parts:</em>
		<ul>
			
			
				
			
				
			
				
			
				
			
				
					
						<li><a href="https://sidneys1.github.io/reverse-engineering/2023/02/23/reverse-engineering-a-win95-game-I.html">Reverse Engineering a Windows 95 Game &ndash; Reversing Asset Storage</a> (Part I)</li>
					
					
				
			
				
					
						<li><a href="https://sidneys1.github.io/reverse-engineering/2023/03/16/reverse-engineering-a-win95-game-II.html">Reverse Engineering a Windows 95 Game &ndash; Reversing (Undocumented) Settings</a> (Part II)</li>
					
					
				
			
				
			
				
					
						<li style="list-style-type: disclosure-closed;"><em>Reverse Engineering a Windows 95 Game &ndash; Editor Mode, and Conclusion</em> (Part III)</li>
					
					
				
			
				
			
				
			
				
			
			
		</ul>
	</div><hr>

	<div class="donate">
		Like what you read?
		<a href="https://ko-fi.com/sidneys1" target="_blank" rel="noreferrer">
			Consider buying me a coffee.
		</a>
		<br/>
		<a title="Consider buying me a coffee." href="https://ko-fi.com/sidneys1" target="_blank" rel="noreferrer" style="display: inline-block;">
			<!-- <img height="50px" title="Buy me a Coffee" src="https://sidneys1.github.io/assets/coffee-cup-1.svg"/> -->
			<svg class="svg-icon grey">
				<use xlink:href="/assets/coffee-cup-1.svg#coffee"></use>
			</svg>
		</a>
	</div><p class="todo">Comments only visible under <code>site.mode == "www" or site.mode == "local-prod"</code>!</p><a class="u-url" href="https://sidneys1.github.io/reverse-engineering/2024/02/01/reverse-engineering-a-win95-game-III.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
	<data class="u-url" href="https://sidneys1.github.io/"></data>

	<div class="wrapper">

		<div class="footer-col-wrapper">
			<div class="footer-col">
				<ul class="contact-list">
					<li class="p-name">Contact</li><li>
	<a rel="me" href="mailto:Sidneys1@proton.me" target="_blank" title="ProtonMail">
		<svg class="svg-icon">
			<use xlink:href="/assets/minima-social-icons.svg#protonmail"></use>
		</svg>
		<span>ProtonMail</span>
	</a>
</li>
<li>
	<a rel="me" href="mailto:admin@sSidneys1.com" target="_blank" title="Site Support">
		<svg class="svg-icon">
			<use xlink:href="/assets/minima-social-icons.svg#email"></use>
		</svg>
		<span>Site Support</span>
	</a>
</li>
<li>
	<a rel="me" href="https://matrix.to/#/@sidneys1:matrix.org" target="_blank" title="Matrix Chat">
		<svg class="svg-icon">
			<use xlink:href="/assets/minima-social-icons.svg#matrix"></use>
		</svg>
		<span>Matrix Chat</span>
	</a>
</li>
<li>
	<a rel="me" href="https://simplex.chat/contact#/?v=1-2&smp=smp%3A%2F%2FSkIkI6EPd2D63F4xFKfHk7I1UGZVNn6k1QWZ5rcyr6w%3D%40smp9.simplex.im%2FQwoc8ketLODmigLCuVhCt8Eio_ruJFnj%23%2F%3Fv%3D1-2%26dh%3DMCowBQYDK2VuAyEAtEpK9f8ocpGt_MYmDVj0FrCIorSk7PSIVI-BmxLHUHE%253D%26srv%3Djssqzccmrcws6bhmn77vgmhfjmhwlyr3u7puw4erkyoosywgl67slqqd.onion" target="_blank" title="SimpleX Chat">
		<svg class="svg-icon">
			<use xlink:href="/assets/minima-social-icons.svg#simplex"></use>
		</svg>
		<span>SimpleX Chat</span>
	</a>
</li>
</ul>
			</div>
			<div class="footer-col site-desc">
				<p>A home for all my ramblings on subjects such as programming, cybersecurity, photography, videography, video games, and whatever else I see fit.</p><hr>
			</div>
			<div class="footer-col">
				<ul class="access-list">
					<li class="p-name">Alternative Access</li><li>
	<a rel="me" href="http://sidneys77crlfslcr7zmj3msmxchgnxhrxlp3p3kbaswo7twchjnicid.onion" target="_blank" title="Tor">
		<span>Tor</span>
		<svg class="svg-icon grey">
			<use xlink:href="/assets/minima-social-icons.svg#tor"></use>
		</svg>
	</a>
</li>
<li>
	<a rel="me" href="https://sidneys1-com.ipns.cf-ipfs.com/" target="_blank" title="IPFS (Cloudflare)">
		<span>IPFS (Cloudflare)</span>
		<svg class="svg-icon grey">
			<use xlink:href="/assets/minima-social-icons.svg#ipfs"></use>
		</svg>
	</a>
</li>
<li>
	<a rel="me" href="https://sidneys1.github.io" target="_blank" title="GitHub Pages">
		<span>GitHub Pages</span>
		<svg class="svg-icon grey">
			<use xlink:href="/assets/minima-social-icons.svg#github"></use>
		</svg>
	</a>
</li>
</ul>
			</div>
			<div class="footer-col">
				<div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/Sidneys1" target="_blank" title="GitHub">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a href="/feed.xml" target="_blank" title="Sidneys1.com RSS Feed">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.youtube.com/channel/UCoCiN9Yd8ifG1PeVb6wY0jg" target="_blank" title="YouTube Channel">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#youtube"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://infosec.exchange/@Sidneys1" target="_blank" title="Mastodon (infosec.exchange)">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#mastodon"></use>
    </svg>
  </a>
</li>
</ul>
</div>
			</div>
		</div>

	</div>

</footer>
</body>

</html>
